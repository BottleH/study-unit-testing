## 9. 목 처리에 대한 모범 사례

```
ㅁ. 목의 가치를 극대화하기
ㅁ. 목을 스파이로 교체하기
ㅁ. 목 처리에 대한 모범 사례
```
- 목(Mock)이란? : 테스트 대상 시스템과 의존성 간의 상호 작용을 모방하고 검사하는데 도움이 되는 테스트 대역 (외부 애플리케이션에서 식별할 수 있는 비관리 의존성에만 사용)
---

### 9.1 목의 가치를극대화하기
- (복습) 로깅의 종류
```
ㅁ. 지원 로깅 : 지원 담당자나 시스템 관리자가 추적 할 수 있는 메시지를 생성하는 로깅
ㅁ. 진단 로깅 : 개발자가 애플리케이션 내부 상황을 파악할 수 있도록 돕는 로깅
```

#### 9.1.1 시스템 끝에서 상호 작용 검증하기
- 목(Mock)은 반드시 **'시스템 끝'** 에서 **'비관리 의존성과 의 상호 작용 검증'** 하는 용도로 사용해야 한다.
- 비관리 의존성에 대한 호출은 애플리케이션을 떠나기 전 몇단계를 거치므로, 마지막 단계를 선택해 목으로 대체하는 방법이 가장 좋다.
```
interface IBus {
    void send(String message);
}

interface IMessageBus {
    void sendEmailChangedMessage(int userId, String newEmail);
}

class MessageBus implements IMessageBus {

    private IBus iBus;

    @Override
    public void sendEmailChangedMessage(int userId, String newEmail) {
        this.iBus.send("Type : USER EMAIL CHANGED; $Id : " + userId + " $NewEmail : " + newEmail);a
    }
}
```
- 위와 같은 interface 와 class 의 구성이 존재할 경우. IBus 가 실제 시스템 끝에 존재하므로, IMessageBus 대신 IBus 를 목으로 사용하면 **'회귀 방지'** 가 더 좋아진다.

#### 9.1.2 목을 스파이로 대체하기

- 스파이(Spy)란? : 수동으로 작성하는 테스트 대역으로써 목(Mock)과 같은 목적을 수행한다. (목은 일반적으로 프레임워크가 제공해주는 기능이다.) 
- 스파이는 검증 단계에서 코드를 재사용해 테스트 크기를 줄이고 가독성을 향상시킨다. 

### 9.2 목 처리에 대한 모범 사례
```
ㅁ. 비관리 의존성에만 목 적용하기
ㅁ. 시스템 끝에 있는 의존성에 대해 상호 작용 검증하기
ㅁ. 통합 테스트에서만 목을 사용하고 단위 테스트에서는 하지 않기
ㅁ. 항상 목 호출 수 확인하기
ㅁ. 보유 타입만 목으로 처리하기
```

#### 9.2.1 목은 통합 테스트만을 위한 것
- 목(Mock)은 비관리 의존성에만 해당하며, 컨트롤러만 이러한 의존성을 처리하는 코드이기 때문에 통합 테스트에서 컨트롤러를 테스트할 때만 목을 적용해야 한다.
#### 9.2.2 테스트당 목이 하나일 필요는 없음

- (복습) 테스트의 **'단위'** 는 **'동작 단위'** 를 의미하므로 하나의 테스트안에 여러 클래스가 존재할 수 있다. 
- 마찬가지로 **'동작 단위'** 를 검증하는데 **'필요한 목의 수'** 는 여러개 일 수 있다.

#### 9.2.3 호출 횟수 검증하기
- 비관리 의존성과의 통신에 관해서는 다음 두 가지를 모두 확인하는 것이 좋다.
```
ㅁ. 예상하는 호출이 있는가?
ㅁ. 예상치 못한 호출은 없는가?
```

#### 9.2.4 보유 타입만 목으로 처리하기
- 서드파티 라이브러리 위에 항상 어댑터를 작성하고, 기본 타입 대신 해당 어댑터(adapter)를 목으로 처리해야 한다.
```
ㅁ. 서드파티 코드의 작동 방식에 대해 깊이 이해하지 못하는 경우가 많다.
ㅁ. 해당 코드가 이미 내장 인터페이스를 제공하더라도 목으로 처리한 동작이 실제로 외부 라이브러리와 일치하는지 확인해야 하므로, 해당 인터페이스를 목으로 처리하는 것은 위험하다.
ㅁ. 서드파티 코드의 기술 세부 사항까지는 꼭 필요하지 않기에 어댑터는 이를 추상화하고, 애플리케이션 관점에서 라이브러리와의 관계를 정의한다.
```
