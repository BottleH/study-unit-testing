# 3. 단위 테스트 구조

```
ㅁ. 단위 테스트 구조
ㅁ. 좋은 단위 테스트 명명법
ㅁ. 매개변수화된 테스트 작성
```
---
## 3.1 단위 테스트를 구성하는 방법

### 3.1.1 AAA 패턴 사용
- AAA 패턴은 각 테스트를 준비(Arrange), 실행(Act), 검증(Assert)이라는 세 부분으로 나눌 수 있다.
```
a. 준비 : 테스트 대상 시스템과 해당 의존성을 원하는 상태로 만듬 
b. 실행 : 메서드를 호출하고 준비된 의존성을 전달하며, 출력 값을 캡처한다.
c. 검증 : 결과를 검증한다.
```
- 일반적인 테스트의 경우 **'준비'** 구절부터 시작하는 것이 자연스러우나,TDD(Test-Driven Development) 기반으로 코드를 작성할 때에는 **'검증'** 구절부터 시작할 수 있다. (테스트를 작성할 시점에는 아직 해당 기능에 대한 명확한 동작이 정의되지 않았으므로) 

### 3.1.2 여러 개의 준비, 실행, 검증 구절 피하기

- 여러개의 검증 혹은 준비 구절로 구성된 테스트는 더이상 단위 테스트가 아닌 통합 테스트이다. 
- 위와 같은 테스트는 각 동작을 **'고유'** 의 테스트로 도출할 수 있도록 리팩터링이 필요하다.
- 물론, 해당 테스트가 **'통합 테스트'** 이면서 **'시스템 상태의 흐름이 자연스럽다'** 면 여러 실행과 검증이 있어도 무관하다.

### 3.1.3 테스트 내 if 문 피하기

- 테스트 내의 if 문은 안티 패턴으로 어떠한 테스트던 간에 테스트는 분기가 없어야 한다.

### 3.1.4 각 구절은 얼마나 커야 하는가?

- 준비 구절이 가장 큰 경우 : 일반적으로 가장 큰 비중을 차지한다. 다만, 너무 크다면 같은 테스트 클래스 내 **'비공개 메서드'** 또는 별도의 **'팩토리 클래스'** 로 도출하는 것이 좋다.
- 실행 구절이 한 줄 이상인 경우 : 보통은 코드 한줄이다. 만약, 한줄 이상이라면 테스트 대상(SUT)의 API 에 문제가 있을 수 있다. (유틸리티 or 인프라 코드는 예외일 수 있다.)

### 3.1.5 검증 구절에는 검증문이 얼마나 있어야 하는가

- 테스트당 하나의 검증을 갖는 지침은 잘못된 것이다. 단일 동작의 단위는 여러 결과를 낼 수 있으므로 여러줄의 검증 구문이 존재할 수 있다.

### 3.1.6 종료 단계는 어떤가

- 종료는 일반적으로 별도의 메서드로 도출되, 클래스 내 모든 테스트에서 재사용된다. 
- 다만, 대부분의 단위 테스트는 프로세스 외부에 종속적이지 않으므로 종료 구절이 필요하지 않다. 이는 통합 테스트의 영역이다. 

### 3.1.8 준비, 실행, 검증 주석 제거하기

- AAA 패턴을 따르고 준비 및 검증 구절에 빈 줄을 추가하지 않아도 되는 테스트라면 **'(// 준비 // 실행 // 검증)'** 구절 주석들을 제거하자, 그렇지 않다면 해당 주석을 유지하자.

## 3.3 테스트 간 테스트 픽스처 재사용

- 준비(Arrange) 구절에서 **'텍스트 픽스처'** 를 사용해 코드를 재사용하는 것이 테스트를 줄이면서 단순화 하기 좋은 방법이다.
- 테스트 픽스처 : 
```
a. 테스트 실행 대상 객체를 의미하며, SUT 로 전달되는 인수이다.
b. 각 테스트 실행 전에 알려진 고정 상태로 유지하기 때문에 동일한 결과를 생성한다.
```

- 테스트 픽스처 사용법 
  - 테스트 생성자에서 픽스처를 초기화 (좋지 않은 방법) : 테스트 간 결합도가 높아지며, 가독성이 떨어지기 때문에 사용하면 안된다. 다만, 데이터베이스와 작동하는 통합 테스트의 경우 초기에 한번 연결을 초기화 한다음 어디에서나 재사용 할 수 있으므로 예외로 한다.
  - 테스트 클래스에 비공개 팩토리 메서드를 두는 법 (추천하는 방법) : 테스트 코드를 짧게 하면서, 동시에 테스트 진행 상황에 대한 전체 맥락을 유지할 수 있다.

## 3.4 단위 테스트 명명법

- 올바른 명칭은 테스트가 검증하는 내용과 기본시스템 동작을 이해하는데 도움이 된다.
- **'[테스트대상 메서드][시나리오][예상결과]'** 명명법은 가장 도움이 되지 않는 방법이다.
- 테스트 명칭은 간단한 문구로 고객이나 도메인 전문가에게 의미 있는 방식으로 시스템 동작을 설명해야 한다.

### 3.4.1 단위 테스트 명명 지침

- 엄격한 명명 정책을 따르지 않는다. (표현의 자유를 허용하라)
- 문제 도메인에 익숙한 비개발자들에게 시나리오는 설명하는 것 처럼 이름을 짓자
- 단어를 밑줄(_) 표시로 구분해 가독성을 향상 시키자.

### 3.4.2 지침에 따른 테스트 이름 변경

```
ㅁ. 변경 전 : IsDeliveryValid_InvalidDate_ReturnsFalse() 
ㅁ. 변경 후 : Delivery_with_a_past_date_is_invalid()
```