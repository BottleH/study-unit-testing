# 2. 단위 테스트란 무엇인가

```
ㅁ. 단위 테스트란?
ㅁ. 공유 의존성, 비공개 의존성, 휘발성 의존성 간의 차의점
ㅁ. 단위 테스트의 두 분파: 고전파와 런던파
ㅁ. 단위 테스트, 통합 테스트, 엔드 투 엔드 테스트의 차이점
```
---
## 2.1 '단위 테스트'의 정의

단위 테스트란 아래의 정의를 가진다.

- 작은 코드 조각을 검증하고
- 빠르게 수행하고
- 격리된 방식으로 처리하는 자동화된 테스트

이때 **'격리'** 에 대한 대중의 의견이 크게 갈리는데 이 근원적 차이로 인해 **'고전파 (고전주의적 접근법)'** 와 **'런던파 (목 추종자)'** 가 구분된다.

### 2.1.1 격리 문제에 대한 런던파의 접근

- 런던파에게 격리란? : 테스트 대상 시스템을 **'모든 협력자'** 에게서 격리하는 것을 의미한다.
- 런던파의 원칙은? : 하나의 클래스가 의존하고 있는 **'모든 의존성'** 을 **'목(Mock)'** 으로 대체하는것을 원칙으로 한다.
- 런던파의 장점은? 
  - 테스트가 실패하면 코드베이스의 어느 부분이 고장 났는지 **'확실히'** 알 수 있다.
  - 객체 그래프(같은 문제를 해결하는 클래스의 통신망)를 분할할 수 있다.
  - 전체 단위 테스트 스위트를 간단한 구조로 할 수 있다.

### 2.1.2 격리 문제에 대한 고전파의 접근

- 고전파에게 격리란? :  테스트 간에 **'공유상태'** 를 일으키는 의존성에 대해서만 격리를 하는 것을 의미한다.
- 고전파의 원칙은? : 코드를 꼭 격리하는 방식으로 테스트해야 하는 것은 아니다. 대신 단위 테스트 끼리는 서로 격리해서 실행해야한다.
- 고전파의 장점은?
    - 공유 의존성(일반적으로 실행 프로세스 외부에 존재)을 대체함으로써 테스트 실행 속도를 높일 수 있다.
    - 테스트 단위가 반드시 클래스에 국한되지 않으므로 여러 클래스를 묶어서 테스트할 수 있다.
    
---
## 2.2 단위 테스트의 런던파와 고전파

- 런던파 : 단위 (격리 주체) / 단일 클래스 (단위의 크기) / 불변 의존성 외 모든 의존성 (테스트 대역 사용 대상)
- 고전파 : 단위 테스트 (격리 주체) / 단일 클래스 또는 클래스 세트 (단위의 크기) / 공유 의존성 (테스트 대역 사용 대상)

---
## 2.3 고전파와 런던파의 비교

```
작가의 생각 : 고전파가 고품질의 테스트를 만들고 
단위 테스트의 궁극적인 목표인 프로젝트의 지속 가능한 성장을 달성하는 데 더 적합하다. 
그 이유는 취약성에 있는데, 목(Mock)을 사용하는 테스트는 고전적인 테스트보다 불안정한 경향이 있기 때문이다.
```

### 2.3.1 한 번에 한 클래스만 테스트하기

- 런던파 의견 : 클래스를 테스트에서 검증할 원자 단위로 취급해야 된다.
- 고전파 반박 : 테스트는 코드의 단위가 아니라, 동작의 단위 즉, 비즈니스 적으로 유용하다고 인식할 수 있는 것을 단위로 취급해야 한다. 

### 2.3.2 상호 연결된 클래스의 큰 그래프를 단위 테스트하기

- 런던파 의견 : 의존성을 목(Mock)으로 대체하면 의존성 그래프가 복잡하게 얽혀있는 클래스를 쉽게 테스트 할 수 있다.
- 고전파 반박 : 대게 클래스 그래프가 크다는 것은 근본적인 설계의 문제이다. 게다가 목을 사용하는 것은 문제를 감추기만 할 뿐, 원인을 해결하지 못한다.

### 2.3.3 버그 위치 정확히 찾아내기

- 런던파 의견 : 고전파의 방식은 하나의 버그가 전체 시스템에 거려 테스트 실패를 야기하므로 문제를 파악하고 디버깅하는데 시간이 걸린다.
- 고전파 반박 : 테스트를 정기적으로 실행하면 버그의 원인을 알아낼 수 있다. 또한, 만약 하나의 코드 조각이 많은 테스트의 결함으로 이어진다면 이는 오히려 유용한 정보이다.

## 2.4 두 분파의 통합 테스트

- 런던파 : 협력자 객체를 사용하는 모든 테스트를 통합 테스트로 간주한다. (고전파의 테스트 코드를 런던파는 통합 테스트로 느낀다)
- 고전파 : 고전파 입장에서 다시 정의한 아래 단위 테스트의 정의 중 하나라도 충족하지 않으면 통합 테스트이다.

```
- 단일 동작 단위를 검증하고
- 빠르게 수행하고
- 다른 테스트와 별도로 처리한다.
```

### 2.4.1 통합 테스트의 일부인 엔드 투 엔드 테스트

- 통합 테스트란? : 공유 의존성, 프로세스 외부 의존성 뿐만 아니라 조직 내 다른 팀이 개발한 코드 등과 통합해 작동하는지도 검증하는 테스트 (외부 의존성을 한두개만 갖고 동작)
- 엔드 투 엔드 테스트 : 통합 테스트의 일부로 외부 의존성을 전부 또는 대다수 갖고 하는 테스트. 즉, 시스템을 최종 사용자의 관점에서 검증하는 것을 의미