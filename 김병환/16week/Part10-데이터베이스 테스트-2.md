# 📚 10장 데이터베이스 테스트

목에 대해 리팩터링 내성과 회귀 방지를 최대화해서 최대 가치의 통합 테스트를 개발하는 데 도움이 되는 지침을 알아본다.

## 📖 10.4 테스트 구절에서 코드 재사용하기

___

통합 테스트를 짧게 하기에 가장 좋은 방법은 비즈니스와 관련이 없는 기술적인 부분을 비공개 메서드나 헬퍼 클래스로 추출하는 것

### 🔖 10.4.1 준비 구절에서 코드 재사용하기

테스트 준비 구절 간에 코드를 재사용하기에 가장 좋은 방법은 비공개 팩토리 메서드를 도입하는 것

- 기본값을 사용하면 인수를 선택적으로 지정
- 선택적 인수를 사용하면 어떤 인수가 테스트 시나리오와 관련이 있는지도 강조할 수 있음.

팩토리 메서드의 위치는 동일한 클래스에 배치

- 코드 복제가 중요한 문제가 될 경우에만 별도의 헬퍼 클래스로 이동
- 기초 클래스에 팩토리 메서드를 넣지 말라.
  - 기초 클래스는 데이터 정리와 같이 모든 테스트에서 실행해야 하는 코드를 위한 클래스

### 🔖 10.4.2 실행 구절에서 코드 재사용하기

decorator 메서드를 사용하면 테스트의 실행 구절은 몇 줄만으로 충분하다.

- 어떤 컨트롤러 기능을 호출해야 하는지에 대한 정보가 있는 대리자(delegate)를 받는 메서드를 도입

### 🔖 10.4.3 검증 구절에서 코드 재사용하기

- 헬퍼 메서드 사용
- 플루언트 인터페이스 활용

### 🔖 10.4.4 테스트가 데이터베이스 트랜잭션을 너무 많이 생성하는가?

유지 보수성을 위해 성능을 양보함으로써 절충하는 것이 좋다.

- **빠른 피드백**과 **유지 보수성** 간의 절충

## 📖 10.5 데이터베이스 테스트에 대한 일반적인 질문

___

### 🔖 10.5.1 읽기 테스트를 해야 하는가?

쓰기는 위험성이 높기 때문에 철저히 테스트하는 것이 매우 중요하다.

그러나 읽기는 가장 복잡하거나 중요한 읽기 작업만 테스트하고, 나머지는 무시하라.

- 읽기를 테스트하는 경우에는 성능 면에서 ORM보다 우수한 일반 SQL을 사용하는 것이 좋다

### 🔖 10.5.2 리포지터리 테스트를 해야 하는가?

리포지터리는 복잡도가 거의 없고 프로세스 외부 의존성인 데이터베이스와 통신한다.

- 외부 의존성이 있으므로 유지비⬆️
- 테스트하기 가장 좋은 방법은 약간의 복잡도를 별도의 알고리즘으로 추춭하고 해당 알고리즘 전용 테스트를 작성

리포지터리는 직접 테스트하지 말고, 포괄적인 통합 테스트 스위트의 일부로 취급하라.

## 📖 10.6 결론

___

데이터베이스 테스트를 잘 만들면 버그로부터 훌륭히 보호할 수 있다.

- 특히, ORM 전환 혹은 DB 공급업체 변경에 큰 도움이 된다.
