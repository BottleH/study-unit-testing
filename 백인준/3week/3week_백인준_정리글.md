# [Unit Testing] 3장 단위 테스트 구조?

##3.1 단위테스트를 구성하는 방법

- AAA패턴 사용
  - 준비,실행,검증 이라는 세부분
  - 모든 테스트가 단순하고 균일한 일관성을 가지는것이 큰 장점
  - give(준비 의존성을 원하는상태로만든다) , when(메서드 호출 및 출력값을 캡쳐) ,then(검증) 패턴을 사용  
  - 테스트 스위트의 유지보수 비용을 줄인다.
- 여러 개의 준비, 실행, 검증 구절 피하기
  - 실행이 하나면 하나의 단위테스트가 있게 보장
  - 여러구절의 테스트는 단위테스트가 아니라 통합테스트이다.
- 테스트 내 if 문 피하기
  - if문은 안티패턴
    - 한번에 너무 많은것을 검증 하는것으로 이런테스트를 여러 테스트로 나눠야한다.
- 각 구절은 얼마나 커야하는가?
  - 준비구절이 가장 큰경우
    - 별도의 팩토리 메서드로 도출하는것이 좋다.
      - 오브젝트 마터,테스트 데이터 빌더 패턴이있다.
  - 실행구절이 한줄 이상인 경우를 경계하라
    - 실행구절은 보통 코드 한줄 
      - 이 경우는 단일메서드 호출이면서 잘설계된 클래스 
    - 두개의 구절이 있는경우는 불변위반이 생길수있다.
      - 이러한것을 보호하는 것이 캡슐화 
  - 검증구절에는 검증문이 얼마나 있어야 하는가?
    - 단위테스트의 단위는 코드단위가 아니라 동작의 단위여서 하나의 테스트로 모든 동작단위를 검증하는것이 좋다.
    - 하지만 그렇다고 해도 너무 커지는것보단 객체 클래스 내에서ㅏ 동등멤버를 정의하는것이 좋다.
  - 종료 단계는 어떤가?
    - 검증이후의 단계
    - 테스트 데이터나 작성된 파일을 지움으로써 단위테스트가 외부 종속성에 영향을 미치지않도록 하여야한다.
  - 테스트 대상 시스템 구별하기
    - SUT는 테스트에서 중요한 역할인데 ->동작에대한 진입점을 제공
    - 진입점이 너무 많으면 테스트 대상을 찾는 시간이 오래걸린다.
  - 준비,실행,검증 주석 제거하기
    - 준비 실행 검증을 빈줄로 구분하면 간결성과 가독성이 증가한다.
      - 대규모 테스트에서는 잘 작동하지 않는다.

## 3.2 XUnit 테스트 프레임워크 살펴보기
- 단위테스트 프레임 워크는 모두 비슷하다.

##3.3 테스트간 테스트 픽스처 재사용
- 테스트 픽스처는 실행대상 객체
- 첫번째 방법 테스트 생성자에서 픽스처 초기화 
  - 테스트간 결합도 저하및 가독성이 떨어진다.
  - 테스트간의 높은 결합도는 안티패턴
    - 테스트의 준비 로직을 수정하면 클래스의 모든테스트에 영향
    - 테스트를 수정해도 영향을 주면 안된다.
  - 테스트 가독성을 떨어뜨리는 생성자 사용
    - 테스트 메서드가 무엇을 하는지 이해하기위해 다른로직도 봐야한다.
- 두번째 방법 팩토리 메서드를 두는것
  - 테스트 코드를 짧게함과 동시에 진행상황 맥락을 유지
  - 예외는 데이터베이스 같은 외부종속성은 클래스 생성자에서 연결을 초기화

##3.4 단위테스트 명명법
- 간단하고 쉬운 영어 구문이 훨씬 효과적
- 단위테스트 명명지침
  - 엄격한 명명정책대신 표현의 자유허용
  - 비개발자에게 설명하는것처럼 짓자
  - 단어를 밑줄로 표시 구분

