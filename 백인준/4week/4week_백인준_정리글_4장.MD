# [Unit Testing] 4장 좋은 단위 테스트의 4대요소

## 4.1 좋은 단위 테스트의 4대요소

1. 회귀 방지

- 회귀는 코드를 수정후 기능이 의도한대로 동작하지 않는경우
- 회귀 방지 지표에 대한 테스트 점수에대한 고려
    - 테스트 중에 실행되는 코드의 양
        - 코드가 많을수록 테스트에서 회귀가 나타날 가능성이 높다.
        - 코드가 생성하는 결과가 유효한지 확인
    - 코드 복잡도
    - 코드의 도메인 유희성
        - 보일러플레이트 코드보다 복잡한 비즈니스 코드가 더중요
        - 비즈니스에 중요한 기능에서 발생한 버그가 가장큰 피해를 입기때문에
- 테스트가 가능한 한 많은 코드를 실행하는 것을 목표로 작성

2. 리팩터링 내성

- 테스트를 빨간색(실패)로 바꾸지 않고 코드를 리팩터링 할수 있는지에 대한 척도
- 코드를 정리하면서 리팩터링할때 기능은 정상동작하지만 테스트가 실패할때를 거짓양성이라고 한다.
    - 실제로 기능은작동하지만 테스트는 실패를 나타내는것
    - 거짓양성은 코드가 고장났을때 테스트가 조기경고를 주는것과 코드변경이 회귀로 이어지지 않는다는 확신에대해 방해를 하게된다.
    - 따라서 타당한 실패를 무시하고 고장이나도 운영환경에 들어가고 테스트에 대한 신뢰가 떨어지면서 회귀를 피하기위해 코드변경을 최소한으로 줄여 리팩터링을 안하게된다.
- 무엇이 거짓양성의 원인인가?
  - 거짓양성의수는 테스트 구성방식과 직접관련이 있다.
  - 테스트와 테스트 대상 시스템의 구현세부사항과 많이 결합될수록 거짓양성이 많이 발생
  - 해당 구현세부사항과 테스트를 분리하여 SUT 가 제공하는 최종결과를 검증해야한다.
  - 최종 사용자의 관점에서 SUT를 검증하고 최종사용자에게 의미있는 결과만 검증해야한다.
  - 테스트 구성 하는 가장좋은 방법은 문제영역에 대해 이야기
    - 이러한 테스트가 실패하는것은 애플리케이션 동작이 서로 분리되는것을 의미 한다.
    - 무엇이 잘못됬는지 빨리 이해하는데 도움이 된다.
- 구현 세부 사항 대신 최종 결과를 목표로 하기
  - 테스트를 깨지지않고 리팩터링 내성을 높이는 방법은 SUT의 구현 세부사항과 테스트간의 결합을 낮추는것뿐
  - 코드의 내부작업과 테스트사이을 멀리 떨어뜨리고 최종결과를 목표로 작성한다.
3. 빠른피드백
4. 유지보수성

##4.2 첫번째 특성과 두 번째 특성의 본질적인 관계
- 회귀방지와 리팩터링 내성은 정반대의 관점에서 테스트 스위트의 정확도에 기여

1. 테스트 정확도 극대화
- 참음성
  - 테스트가 통과하고 기본 기능이 의도한대로 잘작동하는 상황
- 참양성
  - 기능이 제대로 작동하여 테스트가 실패하는것
- 거짓음섬
  - 테스트에서 오류가 발생하지 않는것
  - 거짓음성을 피하는데 좋은테스트가 회귀방지(거짓음성의 수를 최소화 하는데 도움이된다.)
- 거짓 양성
  - 허위경보 리팩터링 내성이 도움이 된다.
- 회귀방지와 리팩터링 내성은 테스트의 정확도를 극대화 하는것을 목표로 한다.
  - 테스트가 버그 있음을 얼마나 잘나타내는가?(거짓음성(회귀방지)제외)
  - 테스트가 버그 없을을 얼마나 잘나타내는가? (거짓양성(리팩터링내성)제외)

테스트 정확도 = 신호(발견된 버그수)/소음(허위 경보 발생수)

2. 거짓양성과 거짓 음성의 중요성
- 단기적으로는 거짓양성은 거짓음성만큼 나쁘지않다.
  - 초기에는 프로젝트에서 리팩터링이 바로 중요하지않기때문에
  - 그러나 프로젝트가 커짐에따라 리팩터링이 중요해지면 거짓양성에대해서도 신경을 써야한다.

##4.3 세번째 요소와 네번째 요소: 빠른피드백과 유지 보수성
- 빠른피드백은 단위테스트의 필수 속성
  - 빠른 테스트는 코드에 결함이 생기자마자 버그에대해 경고를 줘 버그를 수정하는 비용을 0가까이 줄일수있다.
  - 느린 테스트는 잠재적으로 버그를 뒤늦게 눈에 띄게 해서 버그 수정비용이 증가한다.
- 유지보수성
  - 유지보수성의 지표
    - 테스트가 얼마나 이해하기 어려운가?
      - 테스트 코드는 라인이 적을수록 더읽기 쉽다.
      - 작은테스트는 필요할때 변경이쉽다.
      - 테스트 코드를 일급시민으로 취급하라
    - 테스트가 얼마나 실행하기 어려운가?

