# [Unit Testing] 5장 목과 테스트 취약성

### 5.3 목과 취약성의 관계
- 5.3.1 육각형 아키텍처 정의
  - 애플리케이션 계층 (외부와의 통신 조정) 도메인 계층(비즈니스 로직) 의 조합은 육각형을 형성
  - 도메인 계층과 애플리케이션 서비스 계층 간의 관심사 분리
    - 도메인 계층
      - 해당 비즈니스 로직에 대해서만 책임을 져야 하며 다른 모든 책임은 제외
      - 애플리케이션의 도메인 지식 모음
    - 애플리케이션 계층
      - 외부와의 통신 및 데이터 검색은 애플리케이션 서비스에 귀속 어떤 비즈니스 로직도 있으면 안된다.
      - 비즈니스 유즈케이스
  - 애플리케이션 내부 통신
    - 도메인 계층 내부 클래스는 계층 내부 클래스 끼리 서로 의존하고 애플리케이션 계층에 의존하지 않는다.
    - 도메인 계층은 외부와 완전히 격리 되어야 한다.
  - 애플리케이션 간의 통신
    - 애플리케이션 서비스 계층에 있는 공통 인터페이스를 통해 해당 애플리케이션에 연결
    - 어떤것도 도메인 계층에 직접 연결할수 없다.
  - 각 계층의 API 를 잘 설계(구현 내부사항을 잘 숨기면 캡슐화) 테스트도 프랙탈 구조를 갖지 시작하여 서로 다른
  수준에서 동작을 검증
    <img width="495" alt="5 10" src="https://user-images.githubusercontent.com/58027908/227682748-6b82397b-27de-418e-bc72-b062629f74fb.png">
  - 식별할수 있는 동작은 바깥계층에서 안쪽으로 흐른다.
  - 도메인 계층에서 식별할 수 있는 동작은 각각 구체적인 비즈니스 유즈케이스와 연관
  - 테스트에서 구현 내부사항을 직접 확인 하면 안되고 클래스에서 식별할 수 있는 동작으로서만 검증 해야한다.
- 5.3.2 시스템 내부 통신과 시스템 간 통신
  - 시스템 내부 통신 (애플리케이션 내 클래스 간의 통신)
    - 구현 내부 사항에 해당하여 이러한 협력과 결합시 테스트가 취약해진다.
  - 시스템 간 통신(다른 애플리케이션과 통신)
    - 전체적으로 해당 시스템의 식별할 수 있는 동작을 나타낸다.
    - 목 사용시 외부 애플리케이션 간의 통신 패턴을 확인 할때 좋다.
### 5.3.4 단위 테스트의 고전파와 런던파 재고
- 런던파는 불변 의존성 제외 모든곳에서 목사용을 권장하며 시스템내 통신과 시스템 간 통신을 구분하지 않는다.
- 목을 무분별하게 사용시 구현 내부 사항과 결합돼 테스트에 리팩터링 내성이 없어진다.
- 5.4.1 모든 프로세스 외부 의존성을 목으로 해야 하는 것은 아니다.
  - 고전파에서는 공유 의존성을 피할 것을 권고 테스트 실행시 서로 방해하여 병렬 처리를 할수없어 테스트가 격리되지 않기때문에
  목과 스텁으로 교체한다.
  - 프로세스 외부 의존성이 애플리케이션을 통해서만 접근할 수 있으면 이러한 의존성과의 통신은 시스템에서 식별할수 있는 동작이 아니다.
  - 외부 의존성과 애플리케이션을 같이 배포하면 영향을 미치지 않지만 이러한 시스템 통신 패턴은 구현 세부 사항이 된다.(테스트가 깨지기 쉬움)
- 5.4.2 목을 사용한 동작 검증
  - 목은 개별클래스가 다른 클래스와 소통하는 방식은 식별할 수 있는 동작과는 아무런 관계가 없다.
  - 목은 애플리케이션의 경계를 넘나드는 상호 작용을 검증할 때와 이러한 상호 작용의 사이드 이펙트가 외부 환경에서 보일 때만 동작과 관련이 있다.


  