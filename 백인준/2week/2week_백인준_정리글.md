# [Unit Testing] 2장 단위 테스트란 무엇인가?

## 단위테스트의 정의
- 작은 코드 조각을 검증
- 빠르게 수행
- 격리된 방식으로 처리하는 자동화 테스트
  - 고전파와 런던파로 나뉘게된다.
  - 런던파
    - 테스트대상 시스템을 협력자에게서 격리
    - 즉 하나의 클래스가 다른클래스에 의존하면 이 모든 의존성을 테스트 대역으로 대체
    - JAVA 에서는 의존성 즉 테스트 대역을 MOCK 라이브러리를 사용하여 대체 할수있다.
    - 이점으로 테스트가 실패할시 어느부분에서 고장났는지 확실히 알수있다.
  - 고전파
    - 코드를 꼭 격리해서 테스트하는것이 아니라 여러클래스를 한번에 테스트 해도 괜찮다. (의존성이있는 클래스를 한번에 테스트)
    - 클래스간의 테스트를 할때에는 공유의존성을 테스트대역으로 대체(공유의존성 때문 ex 데이터베이스)
      - 공유의존성은 대상클래스간이 아니라 단위테스트간에 공유될수있어서
      - 공유의존성을 가진 테스트는 단위테스트가 아니라 통합테스트 영역이다.
  

## 단위테스트의 런던파와 고전파
- 런던파
  - 격리주체 : 단위
  - 단위의크기 : 단일클래스
  - 테스트 대역 사용 대상 : 불변의존성 외 모든 의존성
- 고전파
  - 격리주체 : 단위 테스트
  - 단위의크기 : 단일클래스 또는 클래스 세트
  - 테스트 대역 사용 대상 : 공유 의존성

### 고전파와 런던파가 의존성을 다루는 방법
- 불변하는 객체는 실제 객체를 사용 목으로 바꾸지 않는다. 
- 고전파에서는 데이터베이스 같은 단위테스트간에 영향을 미칠수있는 공유의존성을 테스트대역으로 교체한다.
- 런던파는 공유의존성 뿐만 아니라 변경 가능한 의존성을 테스트대역으로 교체한다.

## 고전파와 런던파의 비교
- 책에서는 고전파를 선호한다. 이유는 목을 사용하는 테스트는 취약점이있기때문에
<br><br>
- 런던파
  - 입자성이 좋고 테스트가 세밀하여 한번에 하나의 클래스만 확인
  - 서로 연결된 클래스 (의존성) 의 그래프가 커져도 테스트 하기쉽다.
    - 의존성은 테스트대역으로 대체하기 때문에
  - 테스트가 실패하면 어떤기능이 실패했는지 확실히 알수있다.
    - 하나의 클래스만 테스트하고 의존성은 모두 테스트대역으로 대체 됬기 때문에
### 한 번에 한 클래스만 테스트 하기
- 클래스를 테스트에서 원자단위로 취급하지만 좋은 코드 입자성을 목표로 하는것은 도움되지않는다.
- 테스트가 단일 동작 단위를 검증하는 테스트여야하고 이보다 더작으면 오히려 무엇을 검증하는지 정확히 이해하기 어려워진다.
### 상호 연결된 클래스의 큰그래프를 단위 테스트하기
- 의존성을 테스트대역으로 대체하면 쉽게 테스트 할수있다.
- 의존성이 몇단계에 걸쳐있을경우 좋다
  - 고전파의 경우 테스트 대상을 설정하려면 작업이 많을수있다.
  - 하지만 이런경우는 코드 설계의 문제이다.
### 버그 위치 정확히 찾아내기
- 런던스타일은 버그가 생기면 버그가 포함된 테스트만 실패하지만 고전파는 테스트가 실패할수있다.
- 테스트를 정기적으로 수행하면 빠르게 찾을수있다.
### 고전파와 런던파 사이의 다른 차이점
- 테스트 주도 개발 을 통한 시스템 설계 방식
  - 런던스타일의 단위테스트는 하향식 TDD이다.
    - 상위레벨 테스트 부터 시작 
    - 목을 사용하여 한번에 하나의 클래스만 집중 하여 개발가능하기때문에
  - 실제 객체를 다루기 때문에 똑같은 지침을 두진 않지만 고전파는 보통 상향식 TDD 이다.
- 과도한 명세 문제
  - 런던스타일의 테스트가 고전파보다 구현에 더자주 결합

## 두분파의 통합테스트
- 실제 의존성을 가진 객체를 사용하는 모든 테스트를 통합 테스트로 간주
  - 고전파스타일로 작성된 테스트를 통합테스트로 느껴질수도있다.
- 고전파의 단위테스트
  - 단일동작 검증
  - 빠르게 수행
  - 다튼 테스트와 별도로 처리
- 통합테스트는 위 기준중 하나를 충족하지 않는다.
  - 공유의존성에 접근하는 테스트는 다른 테스트에 영향이가고 느리기떄문에

### 통합테스트의 일부인 엔드투 엔드 테스트
- 프로세스의 외부 종속성과 함께 어떻게 작동하는지 검증
- 외부의존성을 전부 또는 대다수 를 갖고 작동 최종 사용자의 관점에서 검증하는것

