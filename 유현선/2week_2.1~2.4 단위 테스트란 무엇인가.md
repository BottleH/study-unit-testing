# 2장_단위 테스트란 무엇인가

단위 테스트의 중요 속성
- 작은 코드 조각을 검증하고
- 빠르게 수행하고,
- 격리된 방식으로 처리하는 자동화된 테스트


> ## 고전파 vs 런던파 
> 런던파 : 목 추종자(mockist)
>   - 격리 주체 : 단위
>   - 단위의 크기 : 단일 클래스
>   - 테스트 대역 사용 대상 : 불변 의존성 외 모든 의존성
> 
> 고전파 : Detroit, 단위 테스트에 대한 고전주의적 접근법
>   - 격리 주체 : 단위 테스트
>   - 단위의 크기 : 단일 클래스 또는 클래스 세트
>   - 테스트 대역 사용 대상 : 공유 의존성 

## 격리 문제
### 런던파 : 코드를 격리
- 테스트 대상 단위(=단일 클래스)를 서로 분리해야 함
- 테스트하려는 대상 클래스에 의존 클래스가 있다면 이 모든 의존성을 테스트 대역으로 대체해야 한다
- 동작을 외부 영향과 분리해서 테스트 대상 클래스에만 집중

장점
- 테스트 대상 시스템만 검증하는데 집중할 수 있다
- 규모가 큰 상호 연결 객체 그래프를 분할
- 전체 단위 테스트 스위트 구조가 간단해짐
    - Class : Test Class = 1 : 1

### 고전파 : 테스트를 격리 
- 단위 테스트를 서로 격리해야 함 
  - 테스트를 어떤 순서(병렬이나 순차 등)로든 가정 적합한 방식으로 실행할 수 있으며 서로의 결과에 영향을 미치지 않는다.
- 테스트가 서로 소통하고 실행 컨텍스트에 영향을 줄 수 있음 
- 테스트 대상 단위 = 동작 단위 
- 공유 의존성만 테스트 대역으로 대체해야 한다. 

## 고전파와 런던파의 비교
### 고전파 
- 고품질의 테스트를 만들고 단위 테스트의 궁극적인 목표인 프로젝트의 지속 가능한 성장을 달성하는 데 더 적합
- 취약성 fragility : mock 을 사용하는 테스트는 고전적인 테스트보다 불안정한 경향이 있다.

### 런던파의 접근 방식의 이점과 반박
#### 입자성이 좋다 : 세밀한 테스트로 한 번에 한 클래스만 확인한다
- 테스트 대상 클래스에 대한 초점이 잘못됨. 
- 코드 조각을 단위 테스트할 수 없다는 것은 코드 설계에 문제가 있다는 사실을 알려주는 강한 징후 
- 좋은 테스트는 단일 동작 단위를 검증하는 테스트이다 
#### 의존성 격리(mock): 서로 연결된 클래스의 그래프가 커져도 테스트하기 쉽다.
- 상호 연결된 클래스의 크고 복잡한 그래프를 테스트할 방법을 찾는 대신, 먼저 이러한 클래스 그래프를 갖지 않는 데 집중해야한다.
- 클래스 그래프가 커진 것은 코드 설계 문제의 결과다
- mock 을 사용하는 것은 문제의 원인을 해결하지 못함
#### 테스트가 실패하면 어떤 기능이 실패했는지 확실히 알 수 있다.
- 런던 스타일 테스트가 있는 시스템에 버그가 생기면 `SUT`에 버그가 포함된 테스트만 실패한다


### 또다른 차이점
> - 테스트 주도 개발`TDD`을 통한 시스템 설계 방식
> - 과도한 명세 문제

> #### TDD : 테스트 주도 개발
> 테스트에 의존해 프로젝트 개발을 추진하는 소프트웨어 개발 프로세스
> 1. 추가해야 할 기능과 어떻게 동작해야 하는 지를 낱카내는 실패 테스트를 작성
> 2. 테스트가 통과할 만큼 충분히 코드를 작성한다. 이 단계에서 코드가 깨끗하거나 명쾌할 필요는 X
> 3. 코드를 리팩토링한다. 통과 테스트 보호하에서 코드를 안전하게 정리해 좀 더 읽기 쉽고 유지하기 쉽도록 만든다.

런던파 : 하향식 TDD  
고전파 : 상향식 TDD  

과도한 명세 문제 : 테스트가 SUT 의 구현 세부 사항에 결합
- 런던 스타일이 고전 스타일보다 테스트가 구현에 더 자주 결합되는 문제가 있다. 
- 목을 전반적으로 아무 데나 쓰는 것에 유의해야한다. 


## 통합 테스트
- 통합 테스트는 시스템 전체를 검증해 소프트웨어 품질을 기여하는 데 중요한 역할을 함
- 공유 의존성, 프로세스 외부 의존성뿐 아니라 조직 내 다른 팀이 개발한 코드 등과 통합해 작동하는지도 검증하는 테스트
- End to end test 

